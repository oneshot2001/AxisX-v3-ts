# Technical Specification

This is the technical specification for the spec detailed in @.agent-os/specs/2026-02-06-pdf-export/spec.md

> Created: 2026-02-06
> Version: 1.0.0

## Technical Requirements

### PDF Layout (porting v2 Battle Card)

**Header** (per-page):
- Axis yellow (#FFCC33) background banner
- Title: "AxisX Battle Card" in 24pt bold Helvetica
- Generated date, project name, customer name

**Summary Section** (page 1 only):
- Total cameras (unique models)
- Total quantity
- Total MSRP
- "X items with price TBD" warning if applicable

**Per-Item Cards** (light gray background):
- "REPLACING: {manufacturer} {model}" line (competitor info)
- "AXIS {model}" in bold (replacement)
- Quantity and MSRP (or "Price TBD")
- Axis product URL
- "Why Switch" bullet points from `axis_features` array (green text)
- Notes in italic gray (if present)

**Page Break Logic**:
- Calculate each item's height based on content (features count, notes presence)
- Add new page when content would exceed printable area (~270mm)
- Reprint header on each new page

**Footer**:
- "Generated by AxisX - Camera Cross-Reference Tool" in small gray text

### Architecture (three-layer pattern)

**Core** - `src/core/export/pdfGenerator.ts`:
- Pure function `generateBattleCardPDF(options: BattleCardOptions): jsPDF`
- No React dependencies
- Handles all layout, pagination, and rendering
- Testable in isolation

**Hook** - `src/hooks/useExportPDF.ts`:
- Wraps core generator
- Manages dialog open/close state
- Handles download trigger (`doc.save()`)
- Returns `{ isDialogOpen, openDialog, closeDialog, generatePDF, isGenerating }`

**Component** - Export button added to existing `Cart.tsx` + new `ExportDialog.tsx`:
- "Export PDF" button in Cart footer (next to Clear BOM)
- `ExportDialog` uses Fluent UI `Dialog` with two `Input` fields (project name, customer name)
- Dialog has "Generate PDF" and "Cancel" buttons

### File Naming

Output: `AxisX-BattleCard-{projectName}-{YYYYMMDD-HHmmss}.pdf`
- Project name sanitized (spaces to hyphens, special chars stripped)
- Fallback: `AxisX-BattleCard-{YYYYMMDD-HHmmss}.pdf` if no project name

## Approach

**Selected: Port v2 jsPDF implementation to three-layer architecture**

The v2 code in `axisx-v2/src/App.jsx` (lines 851-975) is a monolithic function that mixes PDF generation with React state. The v3 port extracts the PDF layout logic into a pure core function, wraps it with a hook for state management, and adds a Fluent UI dialog for user input.

**Rationale:** jsPDF is already installed (`^2.5.1`), the v2 layout is proven in production, and the three-layer split keeps the generator testable without React.

## External Dependencies

No new dependencies required. jsPDF `^2.5.1` is already in package.json.

## New Types

```typescript
// In src/types/index.ts

export interface BattleCardOptions {
  readonly items: readonly CartItem[];
  readonly summary: CartSummary;
  readonly projectName: string;
  readonly customerName: string;
  readonly generatedDate: Date;
}

export interface ExportMetadata {
  readonly projectName: string;
  readonly customerName: string;
}
```
